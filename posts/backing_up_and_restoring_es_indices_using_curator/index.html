<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='The best way to manage elasticsearch indices is to use Curator. It ships with both API and CLI tool. For this article we are going to use the CLI. Curator has a huge list of features but we are going to focus on snapshot and restore for this article.
Installation First things first, lets install the curator. You can easily do that by running the command below
pip install elasticsearch-curator  Setting things Up Once the curator is installed, we need to give it a path where it will store the backups.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Backing up and Restoring ES Indices Using Curator • Adnan Ahmed'>
<meta property='og:description' content='The best way to manage elasticsearch indices is to use Curator. It ships with both API and CLI tool. For this article we are going to use the CLI. Curator has a huge list of features but we are going to focus on snapshot and restore for this article.
Installation First things first, lets install the curator. You can easily do that by running the command below
pip install elasticsearch-curator  Setting things Up Once the curator is installed, we need to give it a path where it will store the backups.'>
<meta property='og:url' content='https://adnanahmed.info/posts/backing_up_and_restoring_es_indices_using_curator/'>
<meta property='og:site_name' content='Adnan Ahmed'>
<meta property='og:type' content='article'><meta property='article:section' content='posts'><meta property='article:tag' content='elasticsearch'><meta property='article:published_time' content='2017-11-15T00:00:00&#43;01:00'/><meta property='article:modified_time' content='2017-11-15T00:00:00&#43;01:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.49.2" />

  <title>Backing up and Restoring ES Indices Using Curator • Adnan Ahmed</title>
  <link rel='canonical' href='https://adnanahmed.info/posts/backing_up_and_restoring_es_indices_using_curator/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4267b3fa.css'><link rel='stylesheet' href='/css/custom.css'><link rel='stylesheet' href='/css/highlight.github.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-56161851-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>


<body class='page type-posts'>

  <div class='site'>

    <a class='screen-reader-text' href='#content'>Skip to Content</a>

    <div class='main'>

      <nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/posts'>Posts</a>
      </li></ul>
  </div>
</nav>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Adnan Ahmed</p><p class='desc site-desc'>Engineer, Designer, Explorer, Opensourcerer, Educator, Lifelong Learner, Lead Engineer @tajawalae Available for Freelance Work</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Backing up and Restoring ES Indices Using Curator</h1>
      

    </div>
    
<div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2017-11-15T00:00:00&#43;01:00'>2017-11-15</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
4 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  

<p>The best way to manage elasticsearch indices is to use <a href="https://github.com/elastic/curator" target="_blank">Curator</a>. It ships with both API and CLI tool. For this article we are going to use the CLI. Curator has a huge list of <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/about-features.html" target="_blank">features</a> but we are going to focus on <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/snapshot.html" target="_blank">snapshot</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/restore.html" target="_blank">restore</a> for this article.</p>

<h1 id="installation">Installation</h1>

<p>First things first, lets install the curator. You can easily do that by running the command below</p>

<pre><code>pip install elasticsearch-curator
</code></pre>

<h1 id="setting-things-up">Setting things Up</h1>

<p>Once the curator is installed, we need to give it a path where it will store the backups. In order to do that, open up the file <code>/etc/elasticsearch/elasticsearch.yml</code> and add following</p>

<pre><code>path.repo: ['/usr/share/elasticsearch/backup']
</code></pre>

<p>Make sure that the path that you set above is valid, otherwise you will get exception.</p>

<p>Next up, we need to setup the config file for curator that is <code>curator.yml</code>. By default the curator assumes that the config file is placed at <code>~/.curator/curator.yml</code>. But we can override this by passing our custom location using the <code>--config</code> option. For now, let&rsquo;s create the file at the default location.</p>

<p>Open the <code>~/.curator/curator.yml</code> file and and the below</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">client:
  hosts:
    - <span style="color:#e6db74">&#34;ES_HOST&#34;</span>
  port: <span style="color:#e6db74">&#34;ES_PORT&#34;</span>
  use_ssl: False
  ssl_no_validate: False
  timeout: <span style="color:#ae81ff">30</span>

logging:
  loglevel: CRITICAL</code></pre></div>
<blockquote>
<p>Make sure to replace <code>ES_HOST</code> and <code>ES_PORT</code> with your elasticsearch host and port.</p>
</blockquote>

<p>Once the <code>curator.yml</code> is configured, we need to create a repository. Repository is something that will be holding our backup. In order to do that, run the below command</p>

<pre><code>es_repo_mgr create fs --repository es_snapshot_name --location es_snapshot_path --compression true
</code></pre>

<blockquote>
<p>Make sure to replace <code>es_snapshot_name</code> with your backup name and <code>es_snapshot_path</code> with the path that you assigned earlier to <code>path.repo</code>.</p>
</blockquote>

<h1 id="backup">Backup</h1>

<p>Now that we have the setup read, the next step is to create our action file that will be used to create the backup. This file contains the three key parts i.e.</p>

<h2 id="action">Action</h2>

<p>Actions are the tasks which curator can perform on your indices. These actions will run in sequence and each action is assigned a unique number.</p>

<h2 id="options">Options</h2>

<p>Options are settings used by actions. For complete list of actions check <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/options.html" target="_blank">following</a>.</p>

<h2 id="filters">Filters</h2>

<p>Filters are the way to select only the indices you want. Check following <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/filters.html" target="_blank">link</a> for more detail.</p>

<p>Here is how our action file looks like</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">actions:
  <span style="color:#ae81ff">1</span>:
    action: snapshot
    description: <span style="color:#e6db74">&#34;Create snapshot&#34;</span>
    options:
      repository: <span style="color:#e6db74">&#34;es_snapshot_name&#34;</span>
      continue_if_exception: False
      wait_for_completion: True
    filters:
      - filtertype: pattern
        kind: regex
        value: <span style="color:#e6db74">&#34;.*$&#34;</span></code></pre></div>
<p>Lets tear down the above <code>action_backup.yml</code> file. There&rsquo;s only one action and this action is responsible for taking the backup. Replace <code>es_snapshot_name</code> with the name that you used earlier while running <code>es_repo_mgr</code> command. In the filters, I have used the filter type <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/filtertype_pattern.html" target="_blank"><code>pattern</code></a> which will only get the indicies matching the specified pattern. Now this filter type pattern have different <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/fe_kind.html" target="_blank">kinds</a>. The kind that we have specified here is <code>regex</code> and since we want to match all the indices, we are going to use the value of <code>.*$</code></p>

<p>Once the <code>action_backup.yml</code> is ready then run below command to take backup</p>

<pre><code>curator action_backup.yml
</code></pre>

<h1 id="restore">Restore</h1>

<p>In order to restore our backup, put the below in <code>action_restore.yml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">actions:
  <span style="color:#ae81ff">1</span>:
    action: close
    description: <span style="color:#e6db74">&#34;Close indices before restoring snapshot&#34;</span>
    options:
      continue_if_exception: True
      ignore_empty_list: True
    filters:
      - filtertype: pattern
        kind: regex
        value: <span style="color:#e6db74">&#34;.*$&#34;</span>
  <span style="color:#ae81ff">2</span>:
    action: restore
    description: <span style="color:#e6db74">&#34;Restore all indices in the most recent snapshot with state SUCCESS&#34;</span>
    options:
      repository: <span style="color:#e6db74">&#34;es_snapshot_name&#34;</span>
      name:
      indices:
      wait_for_completion: True
    filters:
      - filtertype: state
        state: SUCCESS
  <span style="color:#ae81ff">3</span>:
    action: open
    description: <span style="color:#e6db74">&#34;Open indices after restoring snapshot&#34;</span>
    filters:
      - filtertype: pattern
        kind: regex
        value: <span style="color:#e6db74">&#34;.*$&#34;</span></code></pre></div>
<p>As you can see, the restore action file has 3 actions. First action with number <code>1</code> is for closing the indices so that we can halt any actions that are being performed in order to proceed with the restore. In task numbered <code>2</code> we are doing the actual restore and in task <code>3</code> we are re-opening the closed indices so that we can use them for search.</p>

<p>Now our  backup file is ready, so use following command to restore the backup</p>

<pre><code>curator action_restore.yml
</code></pre>

<p>And that about wraps it up. If you would like to learn more, <a href="https://www.elastic.co/guide/en/elasticsearch/client/curator/current/index.html" target="_blank">find the original docs here</a>. Feel free to leave your comments and feedback down below.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='categories'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
<span class='screen-reader-text'>Categories: </span><a class='category' href='/categories/elasticsearch/'>elasticsearch</a></div>
<div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/elasticsearch/'>elasticsearch</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/posts/c-style-comments-in-elasticsearch-mapping/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Elasticsearch - C Style Comments In Mapping</a>
    </div><div class='next-entry sep-before'>
      <a href='/posts/the-bus-factor/'>
        <span class='screen-reader-text'>Next post: </span>The Bus Factor<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>


<section id='comments' class='comments'>
  <div class='container sep-before'>
    <div class='comments-area'><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "adnanahmed-info" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  </div>
</section>

      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='https://github.com/idnan' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/idnan_se' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://instagram.com/idnan.ahmed' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Instagram account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
  <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/>
  
</svg>
</a>
      </li><li>
        <a href='mailto:idnan.se@gmail.com' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Contact via Email</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <polyline points="22,6 12,13 2,6"/>
  
</svg>
</a>
      </li><li>
        <a href='https://linkedin.com/in/adnaanahmed' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Linkedin account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
  <rect x="2" y="9" width="4" height="12"/>
  <circle cx="4" cy="4" r="2"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</section><div class='copyright'>
  <p> &copy; 2017-2018 Adnan Ahmed </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.59f76c44.js'></script><script src='/js/custom.js'></script><script src='/js/highlight.pack.js'></script><script src='/js/highlight-trigger.js'></script>

</body>

</html>

