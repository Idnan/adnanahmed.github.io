<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='ELK is a collection of opensource products
 Elasticsearch – Used Search and Analyze Logstash – Collects and transform logs Kibana – Visualize and Manage Logs  All of the tools above are being maintained by Elastic. Elasticsearch is a NoSQL search engine, Logstash is a log pipeline that accepts input then transforms it using different filers and finally sends it to different targets. Kibana is a visualizer based on the elasticsearch.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='Hitchhiker&#39;s Guide to ELK Stack • Adnan Ahmed'>
<meta property='og:description' content='ELK is a collection of opensource products
 Elasticsearch – Used Search and Analyze Logstash – Collects and transform logs Kibana – Visualize and Manage Logs  All of the tools above are being maintained by Elastic. Elasticsearch is a NoSQL search engine, Logstash is a log pipeline that accepts input then transforms it using different filers and finally sends it to different targets. Kibana is a visualizer based on the elasticsearch.'>
<meta property='og:url' content='https://adnanahmed.info/posts/hitchhikers-guide-to-elk-stack/'>
<meta property='og:site_name' content='Adnan Ahmed'>
<meta property='og:type' content='article'><meta property='article:section' content='posts'><meta property='article:tag' content='elk'><meta property='article:published_time' content='2018-09-26T00:00:00&#43;01:00'/><meta property='article:modified_time' content='2018-09-26T00:00:00&#43;01:00'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.49.2" />

  <title>Hitchhiker&#39;s Guide to ELK Stack • Adnan Ahmed</title>
  <link rel='canonical' href='https://adnanahmed.info/posts/hitchhikers-guide-to-elk-stack/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.4267b3fa.css'><link rel='stylesheet' href='/css/custom.css'><link rel='stylesheet' href='/css/highlight.github.css'><style>
:root{--color-accent:#ffcd00;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-56161851-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>


<body class='page type-posts'>

  <div class='site'>

    <a class='screen-reader-text' href='#content'>Skip to Content</a>

    <div class='main'>

      <nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    
    <ul><li class='item'>
        <a href='/'>Home</a>
      </li><li class='item'>
        <a href='/about/'>About</a>
      </li><li class='item'>
        <a href='/posts'>Posts</a>
      </li></ul>
  </div>
</nav>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>Adnan Ahmed</p><p class='desc site-desc'>Engineer, Designer, Explorer, Opensourcerer, Educator, Lifelong Learner, Lead Engineer @tajawalae Available for Freelance Work</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Hitchhiker&#39;s Guide to ELK Stack</h1>
      

    </div>
    
<div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2018-09-26T00:00:00&#43;01:00'>2018-09-26</time>
</span>

  
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
4 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  

<p>ELK is a collection of opensource products</p>

<ul>
<li><a href="https://www.elastic.co/products/elasticsearch" target="_blank">Elasticsearch</a> – Used Search and Analyze</li>
<li><a href="https://www.elastic.co/products/logstash" target="_blank">Logstash</a> – Collects and transform logs</li>
<li><a href="https://www.elastic.co/products/kibana" target="_blank">Kibana</a> – Visualize and Manage Logs</li>
</ul>

<p>All of the tools above are being maintained by <a href="https://www.elastic.co/" target="_blank">Elastic</a>. Elasticsearch is a NoSQL search engine, Logstash is a log pipeline that accepts input then transforms it using different filers and finally sends it to different targets. Kibana is a visualizer based on the elasticsearch. Each of them plays an important role in the stack.</p>

<p>There&rsquo;s one more piece in this puzzle called <a href="https://www.elastic.co/products/beats/filebeat" target="_blank">Filebeat</a>. Which is a log shipper that ships logs to logstash. Take a look at the below picture to understand how ELK stack works.</p>

<figure align="center"> 
    <img src="https://i.imgur.com/SzFSXKW.png"/>
</figure>

<p>Let me explain it step by step. For this tutorial, consider we have two servers. On one server, we have the ELK stack setup and other having our application (api or anything) with filebeat installed on it.</p>

<ul>
<li>Application generates the logs</li>
<li>File beat reads the logs from the given path and sends it to Logstash</li>
<li>Logstash receives the logs then it applies some filter(s) on it and transforms the data into specific format and outputs it to elasticsearch</li>
<li>ElasticSearch receives the log and saves them in the index specified by the logstash output part</li>
<li>At the end Kibana is used to visualize the data in different formats that is stored in the elasticsearch on different indices</li>
</ul>

<p>Enough with the theory now lets dive into some practical work</p>

<h2 id="setup-elk-server">Setup ELK Server</h2>

<p>To keep things simple, for the sake of this tutorial, I am going to use <a href="https://www.docker.com/" target="_blank">docker</a>. If you don&rsquo;t have it already installed on your system, go ahead and install it.</p>

<p>Next clone this <a href="https://github.com/Idnan/docker-elk" target="_blank">repo</a></p>

<pre><code>git clone git@github.com:Idnan/docker-elk.git
</code></pre>

<p>After that, go ahead and spin up the server by running the below command</p>

<pre><code>docker-compose up
</code></pre>

<p>ELK stack is up and running with each of the services running on the below listed ports</p>

<table>
<thead>
<tr>
<th>Service</th>
<th>Port</th>
</tr>
</thead>

<tbody>
<tr>
<td>elasticsearch</td>
<td>9200</td>
</tr>

<tr>
<td>kibana</td>
<td>5601</td>
</tr>

<tr>
<td>logstash</td>
<td>5044</td>
</tr>
</tbody>
</table>

<p>Lets go ahead and dive into the cloned repo and see what we have.</p>

<ul>
<li><strong><code>docker-compose.yml</code></strong>  has three services i.e. for elasticsearch, kibana and logstash</li>
<li><strong><code>.env</code></strong> has one variable <code>ELK_VERSION</code> that controls the ELK stack version</li>
<li><strong><code>logstash</code></strong> directory we have two further directories i.e. <code>config</code> and <code>pipelines</code></li>
<li><strong><code>logstash/config</code></strong> contains logstash configuration</li>
<li><strong><code>logstash/pipeline</code></strong> contain 3 kinds of files <a href="https://www.elastic.co/guide/en/logstash/current/input-plugins.html" target="_blank">input</a>, <a href="https://www.elastic.co/guide/en/logstash/current/filter-plugins.html" target="_blank">filters</a>, <a href="https://www.elastic.co/guide/en/logstash/current/output-plugins.html" target="_blank">output</a>

<ul>
<li><code>input</code> file specifies the source of input</li>
<li><code>filters</code> formats the logs into specific format</li>
<li><code>outputs</code> specifies the destination where the formatted logs will be sent</li>
</ul></li>
</ul>

<p>For this article we are going to use <code>filebeat</code> for input, <code>growk</code> for filter and <code>elasticsearch</code> for output. But you are not bound to these you can use any plugin for each one of them.</p>

<p>Our ELK server is now ready.</p>

<h2 id="pushing-the-logs">Pushing the Logs</h2>

<p>Next we have to setup our app server to ship logs to the ELK server. In order to do that we are going to need <a href="https://www.elastic.co/products/beats/filebeat" target="_blank">filebeat</a>. To keep things simple, I am not going to setup a separate docker service for this and just going to use the local installation of filebeat.</p>

<p>Follow this <a href="https://www.elastic.co/downloads/beats/filebeat" target="_blank">link</a> to download filebeat. Once you have it downloaded, unzip it and take a look at <code>filebeat.yml</code> most of the options are self explanatory. Replace the content in <code>filebeat.yml</code> with following</p>

<blockquote>
<p><strong>Note</strong> Replace <code>192.168.99.100</code> with the IP address of your docker machine. In my case it is <code>192.168.99.100</code>, it might be different for you</p>
</blockquote>

<pre><code>filebeat.inputs:  
- type: log  
  enabled: true  
  paths:  
    - /path/to/logs/sample.log  
  
filebeat.config.modules:  
  path: ${path.config}/modules.d/*.yml  
  reload.enabled: false  
    
setup.template.settings:  
  index.number_of_shards: 3  
  
output.logstash:  
  hosts: [&quot;192.168.99.100:5044&quot;]  
  
logging.level: debug
</code></pre>

<p>Replace the <code>/path/to/logs/sample.log</code> with the path where your logs are stored. Now, for the sake of article, I have set it up to parse the specific log format. You can grab the sample logs <a href="https://gist.github.com/Idnan/a034923a47b61988b7f238bccd513957" target="_blank">from this gist</a> and place at the path you have provided in the filebeat config.</p>

<p>Once all is done, run the below command to start shipping logs to ELK sever.</p>

<pre><code>./filebeat -e -c filebeat.yml
</code></pre>

<p>It will automatically start looking for changes in the path that you have specified in <code>filebeat.yml</code></p>

<p>Now let&rsquo;s go ahead and check if our logs are being pushed correctly. Open the following url in your browser. <a href="http://192.168.99.100:9200/sample-*/_search?pretty"><a href="http://192.168.99.100:9200/lumen-*/_search?pretty" target="_blank">http://192.168.99.100:9200/lumen-*/_search?pretty</a></a> and you should see the logs in your browser. Now let&rsquo;s see if we can visualize them in Kibana. For that open this url <a href="http://192.168.99.100:5601" target="_blank">http://192.168.99.100:5601</a> then go to <code>Management</code> &gt; <code>Index Patterns</code>
Then define your index pattern <code>sample-*</code> and click <code>Next Step</code>. On the next screen choose <code>@timestamp</code> as time filter field and click <code>Create index pattern</code> to finish creation. Now go to <code>Discvoer</code> then chose <code>This year</code> from top right corner and you will see your logs. Voilla Kibana is all set up.</p>

<p>And that wraps it up for this article. Feel free to leave your feedback or questions in the comments section.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='categories'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
<span class='screen-reader-text'>Categories: </span><a class='category' href='/categories/devops/'>devops</a></div>
<div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/elk/'>elk</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/posts/the-bus-factor/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>The Bus Factor</a>
    </div></div>
</nav>


<section id='comments' class='comments'>
  <div class='container sep-before'>
    <div class='comments-area'><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "adnanahmed-info" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  </div>
</section>

      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='https://github.com/idnan' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/idnan_se' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://instagram.com/idnan.ahmed' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Instagram account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
  <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
  <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/>
  
</svg>
</a>
      </li><li>
        <a href='mailto:idnan.se@gmail.com' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Contact via Email</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
  <polyline points="22,6 12,13 2,6"/>
  
</svg>
</a>
      </li><li>
        <a href='https://linkedin.com/in/adnaanahmed' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Linkedin account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
  <rect x="2" y="9" width="4" height="12"/>
  <circle cx="4" cy="4" r="2"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</section><div class='copyright'>
  <p> &copy; 2017-2018 Adnan Ahmed </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='/assets/js/main.59f76c44.js'></script><script src='/js/custom.js'></script><script src='/js/highlight.pack.js'></script><script src='/js/highlight-trigger.js'></script>

</body>

</html>

